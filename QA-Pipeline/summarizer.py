from transformers import AutoTokenizer, AutoModelForSeq2SeqLM
import torch
tokenizer = AutoTokenizer.from_pretrained("Falconsai/text_summarization")
model = AutoModelForSeq2SeqLM.from_pretrained("Falconsai/text_summarization")
device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
model = model.to(device)
import re

STEP = 350
MINIMUM_LENGTH = 30

def condense(text: str):
    words = text.split()
    if len(words) > STEP:
        chunks = chunkText(words)
        summaries = []
        for chunk in chunks:
            summary = summarize(chunk)
            #print(f"SUMMARY {summary}")
            summaries.append(summary)
        condensed = " ".join(summaries)
        condensed = condense(condensed)
    else:
        condensed = text
        condensed = re.sub(r'\s+\.', '.', condensed)
    return condensed

def chunkText(words):
    startIndex = 0
    endIndex = STEP
    chunks = []
    while startIndex < len(words):
        chunk = " ".join(words[startIndex:endIndex])
        #print(f"CHUNK {chunk}")
        chunks.append(chunk)
        startIndex = endIndex
        endIndex = endIndex + STEP
    return chunks

def summarize(text: str) -> str:
    tokens = tokenizer(text, 
            padding="max_length", 
            truncation=True,
            max_length=512, 
            return_tensors='pt').to(device)
    summary_tokens = model.generate(tokens['input_ids'], attention_mask = tokens['attention_mask'], max_length=512, num_beams=5)
    summary = tokenizer.batch_decode(summary_tokens, skip_special_tokens=True)
    return summary[0][2:]

#text = "ISLAMABAD, Pakistan (CNN) -- Hours after declaring a state of emergency Saturday, Pakistani President Pervez Musharraf ordered troops to take a television station's equipment and put a popular opposition leader under house arrest. President Pervez Musharraf explains his actions in a televised address Saturday. Musharraf also suspended the constitution and dismissed the Pakistan Supreme Court's chief justice for the second time. On Sunday, police arrested the Javed Hashmi, the acting president of ex-Prime Minister Nawaz Sharif's opposition party was arrested, along with 10 aides, The Associated Press reported. Hashimi was arrested when he stepped outside his house in the central city of Multan, AP reported. The country is at a critical and dangerous juncture -- threatened by rising tensions and spreading terrorism, Musharraf said in a televised address to the nation after declaring martial law. As Pakistani police patrolled the streets of the capital, Islamabad, Musharraf said his actions were \"for the good of Pakistan.\" Watch Musharraf's speech » . There was quick condemnation from within and outside his country. The Supreme Court declared the state of emergency illegal, claiming Musharraf -- who also is Pakistan's military chief -- had no power to suspend the constitution, Chief Justice Iftikhar Mohammed Chaudhry said. Shortly afterward, government troops came to Chaudhry's office and told him the president had dismissed him from his job. Justice Abdul Hameed Dogar was quickly appointed to replace him, according to state television. It was the second time Chaudhry was removed from his post. His ousting by Musharraf in March prompted massive protests, and he was later reinstated. See a timeline of upheaval in Pakistan » . Musharraf complained in his speech that the media -- which he made independent -- have not been supportive, but have reported \"negative\" news. Early Sunday, two dozen policemen raided the offices of AAJ-TV in Islamabad, saying they had orders to take the station's equipment. The government also issued a directive warning the media that any criticism of the president or prime minister would be punishable by three years in jail and a fine of up to $70,000, said Talat Hussain, director of news and current affairs for AAJ. Watch a former Pakistani P.M. call the developments in his country 'disturbing' » . U.S. Secretary of State Condoleezza Rice -- who is in Turkey for a conference with Iraq and neighboring nations -- said The United States doesn't support any extra-constitutional measures taken by Musharraf. \"The situation is just unfolding,\" Rice said. \"But anything that takes Pakistan off the democratic path, off the path of civilian rule is a step backward, and it's highly regrettable.\" A senior Pakistani official said the emergency declaration will be \"short-lived,\" and will be followed by an interim government. Martial law is only a way to restore law and order, he said. Mahmud Ali Durrani, Pakistan's ambassador to the United States, agreed. \"I can assure you, he will move on the part of democracy that is promised ... and you will see that happen shortly.\" Musharraf was re-elected president in October, but the election is not yet legally official, because the Supreme Court is hearing constitutional challenges to Musharraf's eligibility filed by the opposition. Under the constitution, Musharraf couldn't run for another term while serving both as president and military leader. The court allowed the election to go ahead, however, saying it would decide the issue later. Some speculated that the declaration of emergency is tied to rumors the court was planning to rule against Musharraf. Musharraf has said repeatedly he will step down as military leader before the next term begins on November 15 and has promised to hold parliamentary elections by January 15. Meanwhile, popular opposition leader Imran Khan said early Sunday that police surrounded his house in Lahore, barged in and told him he was under house arrest. Musharraf also had Khan placed under house arrest during a government crackdown in March 2006. Asked about Musharraf's actions Saturday, Khan said, \"We are going to oppose this in every way.\" \"None of us accept ... this whole drama about emergency.\" Former Prime Minister Benazir Bhutto -- who arrived in Karachi Saturday from Dubai, where she had gone to visit her family -- described a \"wave of disappointment\" at Musharraf's actions. Watch crowds surround Bhutto upon her arrival » . Bhutto -- who returned to Pakistan last month after several years in exile -- wants to lift her Pakistan People's Party to victory in January's parliamentary election in the hope she can have a third term as prime minister. The nation's political atmosphere has been tense for months, with Pakistani leaders in August considering a state of emergency because of the growing security threats in the country's lawless tribal regions. But Musharraf, influenced in part by Rice, held off on the move. Watch a report on the volatile situation in Pakistan » . Musharraf, who led the 1999 coup as Pakistan's army chief, has seen his power erode since the failed effort to oust Chaudhry. His administration is also struggling to contain a surge in Islamic militancy. E-mail to a friend . Copyright 2007 CNN. All rights reserved.This material may not be published, broadcast, rewritten, or redistributed. Associated Press contributed to this report. ROME. Italy -- Italy and Roma striker Francesco Totti has threatened to quit the Italian Players Association, in a row over the starting date of the next Serie A season. Roma striker Totti has complained that the Italian players are never listened to. The row began last month, when the Italian Football League, which is run by the presidents of clubs in the country's top two divisions, voted to start the season on August 26. In doing so, they ignored a request by Italy coach Roberto Donadoni to play the first round of matches midway through the month, to give his players time to gain match-fitness ahead of Euro 2008 qualifiers against France and Ukraine in early September. \"I'm ready to leave the Italian Players Association. We are the principal actors, but also the people who are never listened to,\" Totti was quoted as saying in Italian football magazine Dieci. \"This is the moment in which we must make our voice heard. We wanted to start on August 19, to have an extra week's rest at Christmas and allow the national team to come into the big matches in September better prepared. \"Those who decided (on August 26) didn't care at all about Donadoni's needs.\" Serie A is one of the last major European leagues to start next season. The opening round of English Premier League matches is scheduled to start on August 11, while the French Ligue 1 will kick off on August 4. E-mail to a friend . WASHINGTON (CNN) -- Allegations that Blackwater USA -- whose operations were suspended after 20 Iraqi civilians were shot to death last weekend -- was \"in any way associated or complicit in unlawful arms activities are baseless,\" the company asserted Saturday. Blackwater employees patrol Baghdad by air in a February 2005 photograph. Federal prosecutors are investigating allegations that employees of Blackwater illegally purchased weapons and sold them in Iraq, according to U.S. government sources. A U.S. government official has said the U.S. attorney's office in Raleigh, North Carolina, is in the early stages of an investigation that focuses on individual company employees, and not the firm. Blackwater, which is based in Moyock, North Carolina, is a security firm hired by the State Department to guard U.S. staff in Iraq. \"The company has no knowledge of any employee improperly exporting weapons,\" the Blackwater statement said. \"When it was uncovered internally that two employees were stealing from the company, Blackwater immediately fired them and invited the ATF to conduct a thorough investigation.\" Watch a report on Blackwater's response to the allegations » . The first public hint that an investigation was under way came earlier this week in a statement from State Department Inspector General Howard Krongard after he was accused of blocking fraud investigations in Afghanistan and Iraq. Krongard said the State Department has been cooperating with the prosecutors in the Blackwater probe. \"In particular, I made one of my best investigators available to help assistant U.S. attorneys in North Carolina in their investigation into alleged smuggling of weapons into Iraq by a contractor,\" Krongard's statement said. Blackwater resumed normal security operations in Iraq on Friday, the State Department said, after a brief hiatus following the lethal incident last Sunday. The Iraqi government was outraged by the shootings and disputes the U.S. and Blackwater's claim that the guards were responding to an attack. E-mail to a friend . CNN's Elise Labott and Kelli Arena contributed to this report."
#text = re.sub(r'[\t\n]', '', text)
#print(condense(text))